<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Panel de administración</title>
</head>
<body>
<div style="width: 30%; float: left;">
    <fieldset style="width: 250px;">
    <legend>Perfiles de usuario</legend>

    Asignar perfiles a los usuarios<br>
    <select id="usuariosper" style="margin: 5px;">
        <option selected>Usuario</option>
    </select>

    <select id="perfilesusu" style="margin: 5px;">
        <option selected>Perfiles</option>
    </select><br>

    <input type="submit" id="botonper" value="Guardar" style="float: right;">

    </fieldset>
</div>

<div style="width: 68%; float: right;">
    <fieldset style="width: 525px;">
        <legend>Acciones</legend>

        Asignar perfiles a las acciones<br>
        <select id="acciones" style="margin: 5px;">
            <option selected>Acciones</option>
        </select>

        <select id="perfilesacc" style="margin: 5px;">
            <option selected>Perfiles</option>
        </select><br>

        <input type="submit" id="botonacc" value="Guardar" style="float: right;">

    </fieldset>
</div><br><br><br><br><br><br><br>

<div>
    <fieldset style="width: 250px;">
        <legend>Crear usuario</legend>

        <label for="usuario">Nombre:</label>
        <input type="text" id="usuario" size="23" style="margin: 5px"><br>
        <label for="contrasena">Contraseña:</label>
        <input type="password" id="contrasena" size="23" style="margin: 5px"><br>
        <input type="submit" id="botonusu" value="Crear" style="float: right;">

    </fieldset>
</div><br>

<div>
    <fieldset style="width: 250px;">
        <legend>Eliminar usuario</legend>

        <select id="usuarioselim" style="margin: 5px;">
            <option selected>Usuario</option>
        </select>

        <input type="submit" id="botonelimusu" value="Borrar" style="float: right;">

    </fieldset>
</div>

<script type="text/javascript">

    var nombreusu = document.getElementById("usuario");
    var contrasena = document.getElementById("contrasena");

    var usuariosper = document.getElementById("usuariosper");
    var usuarioselim = document.getElementById("usuarioselim");

    var perfilesusu = document.getElementById("perfilesusu");
    var perfilesacc = document.getElementById("perfilesacc");

    var acciones = document.getElementById("acciones");

    var botonusu = document.getElementById("botonusu");
    var botonper = document.getElementById("botonper");
    var botonacc = document.getElementById("botonacc");
    var botonelimusu = document.getElementById("botonelimusu");
    botonusu.addEventListener("click",crearusuario);
    botonper.addEventListener("click",asignarper);
    botonacc.addEventListener("click",asignaracc);
    botonelimusu.addEventListener("click",eliminarusu);

    var xhreq = new XMLHttpRequest();

    var datosusu = {
    }

    datosusu["cont"] = "act";
    xhreq.open("POST", "panelcontroller.php", true);
    xhreq.onreadystatechange = act;
    xhreq.send(JSON.stringify(datosusu));

    function act() {
        if ((xhreq.readyState == 4) && (xhreq.status == 200)) {
            let result = JSON.parse(xhreq.responseText);

            for (i = 0; i < result.resultadousu.length; i++) {
                var opcionesusu = document.createElement("option");
                opcionesusu.innerHTML = result.resultadousu[i];
                usuariosper.appendChild(opcionesusu);

                var opcionusu = document.createElement("option");
                opcionusu.innerHTML = result.resultadousu[i];
                usuarioselim.appendChild(opcionusu);
            }

            for (i = 0; i < result.resultadoper.length; i++) {
                var opcionesper = document.createElement("option");
                opcionesper.innerHTML = result.resultadoper[i];
                perfilesusu.appendChild(opcionesper);

                var opcionper = document.createElement("option");
                opcionper.innerHTML = result.resultadoper[i];
                perfilesacc.appendChild(opcionper);
            }

            for (i = 0; i < result.resultadoacc.length; i++) {
                var opcionesacc = document.createElement("option");
                opcionesacc.innerHTML = result.resultadoacc[i];
                acciones.appendChild(opcionesacc);
            }
        }
    }

    function crearusuario(event) {
        datosusu["nombreusuario"] = nombreusu.value;
        datosusu["contrasenausuario"] = contrasena.value;
        datosusu["cont"] = "crearusuario";

        if ((nombreusu.value == "") || (contrasena.value == "")) {
            alert("No has escrito el nombre de usuario o la contrasena correctamente");
        }
        else {
            xhreq.open("POST", "panelcontroller.php", true);
            xhreq.onreadystatechange = recibirusu;
            xhreq.send(JSON.stringify(datosusu));
        }
    }

    function recibirusu() {
        if ((xhreq.readyState == 4) && (xhreq.status == 200)) {
            let result = JSON.parse(xhreq.responseText);

            while (usuariosper.length > 1) {
                usuariosper.removeChild(usuariosper.item(1));
            }

            while (usuarioselim.length > 1) {
                usuarioselim.removeChild(usuarioselim.item(1));
            }

            for (i = 0; i < result.resultadousu.length; i++) {
                var opciones = document.createElement("option");
                opciones.innerHTML = result.resultadousu[i];
                usuariosper.appendChild(opciones);

                var opcion = document.createElement("option");
                opcion.innerHTML = result.resultadousu[i];
                usuarioselim.appendChild(opcion);
            }

            alert(result.mensaje);
        }
    }

    function asignarper(event) {
        datosusu["perfilnomusu"] = usuariosper.value;
        datosusu["perfilusu"] = perfilesusu.value;
        datosusu["cont"] = "asignarper";

        if ((usuariosper.value == "Usuario") || (perfilesusu.value == "Perfiles")){
           alert("No has seleccionado los usuarios o los perfiles correctamente");
        }
        else {
            xhreq.open("POST", "panelcontroller.php", true);
            xhreq.onreadystatechange = recibirmen;
            xhreq.send(JSON.stringify(datosusu));
        }
    }

    function asignaracc(event) {
        datosusu["accionnom"] = acciones.value;
        datosusu["perfilesacc"] = perfilesacc.value;
        datosusu["cont"] = "asignaracc";

        if ((acciones.value == "Acciones") || (perfilesacc.value == "Perfiles")){
            alert("No has seleccionado las acciones o los perfiles correctamente");
        }
        else {
            xhreq.open("POST", "panelcontroller.php", true);
            xhreq.onreadystatechange = recibirmen;
            xhreq.send(JSON.stringify(datosusu));
        }
    }

    function eliminarusu(event) {
        datosusu["usuarioelim"] = usuarioselim.value;
        datosusu["cont"] = "eliminarusu";

        if (usuarioselim.value == "Usuario"){
            alert("No has seleccionado el usuario correctamente");
        }
        else {
            xhreq.open("POST", "panelcontroller.php", true);
            xhreq.onreadystatechange = recibirusu;
            xhreq.send(JSON.stringify(datosusu));
        }
    }

    function recibirmen() {
        if ((xhreq.readyState == 4) && (xhreq.status == 200)) {
            let result = JSON.parse(xhreq.responseText);
            alert(result.mensaje);
        }
    }

</script>
</body>
</html>

